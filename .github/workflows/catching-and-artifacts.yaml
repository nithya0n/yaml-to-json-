name: Caching and Artifacts
on: [workflow_dispatch]

jobs:
  use-axios:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      # FIX: Use npm install instead of npm ci
      - name: Install dependencies
        run: npm install
      
      - name: Display package info
        run: |
          echo "Node: $(node --version)"
          echo "NPM: $(npm --version)"
          echo "Dependencies installed successfully!"
      
      - name: Run Tests
        run: npm test
      
      - name: Upload Code Coverage Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: code-coverage-report
          path: coverage/
          retention-days: 10
      
      - name: Download Code Coverage
        uses: actions/download-artifact@v4
        with:
          name: code-coverage-report
          path: downloaded-coverage/
      
      - name: Verify download
        run: ls -la downloaded-coverage/
      
      - name: Use Axios for Dad Joke
        uses: actions/github-script@v6
        with:
          script: |
            const axios = require('axios');
            try {
              const response = await axios.get('https://icanhazdadjoke.com/', {
                headers: { 
                  'Accept': 'text/plain',
                  'User-Agent': 'GitHub Actions Workflow'
                }
              });
              console.log('ðŸ˜‚ Dad Joke:', response.data);
            } catch (error) {
              console.log('ðŸ˜ž No joke today:', error.message);
            }